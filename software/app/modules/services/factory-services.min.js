app.factory('Products', function($http, $httpParamSerializer, $location){
	var protocol = $location.protocol();
	var host = $location.host();
	var pathImgUrl = "/__admin/uploads/software/file-images/";
	var prd = {};
	var _baseUrl = protocol + '://' + host + "/__admin/index.php/apis/products";

	prd.getImgUrl = function(){
		return protocol + '://' + host + pathImgUrl;
	};

	var makeUrl = function(params, cb){
		cb(_baseUrl + params);
	};

	var sendRequest = function(method, cb){
		makeUrl(method, function(url){
			$http.get(url).success(function(r){
				return cb(null, r);
			}).error(function(e){
				return cb(e, null);
			});
		});
	};

	var queryBuilder = function(opt, cb){
		var optLength = Object.keys(opt).length;
		if(optLength > 0){
			var query = $httpParamSerializer(opt);
			cb(null,"?" + query);
		}else{
			cb(null, null);
		}
	};
/*
	GET ALL PRODUCT WITHOUT WHERE
*/
	prd.getAll = function(opt, cb){
		var url = '/getAllProducts';
		queryBuilder(opt, function(e, q){
			if(q){
				/* request with */
				url += q;
			}
			sendRequest(url, function(e, r){
				if(r){
					return cb(null, r);
				}else{
					return cb(e, null);
				}
			});
		});
	};
/*
	GET LATEST PRODUCT
*/
	prd.getLatestProducts = function(opt, cb){
		var url = '/getLatestProducts';
		queryBuilder(opt, function(e, q){
			if(q){
				/* request with */
				url += q;
			}
			sendRequest(url, function(e, r){
				if(r){
					return cb(null, r);
				}else{
					return cb(e, null);
				}
			});
		});
	};
/*
	GET LATEST PRODUCT
*/
	prd.getInProgressProducts = function(opt, cb){
		var url = '/getProgressProducts';
		queryBuilder(opt, function(e, q){
			if(q){
				/* request with */
				url += q;
			}
			sendRequest(url, function(e, r){
				if(r){
					return cb(null, r);
				}else{
					return cb(e, null);
				}
			});
		});
	};
/*
	GET SPESIFIC PRODUCT WITH ID
*/
	prd.getProduct = function(id, opt, cb){
		var url = '/getProduct/' + id;
		queryBuilder(opt, function(e, q){
			if(q){
				/* request with */
				url += q;
			}
			sendRequest(url, function(e, r){
				if(r){
					return cb(null, r);
				}else{
					return cb(e, null);
				}
			});
		});
	};
/*
	GET ACTIVE PRODUCT WITH WHERE
*/
	prd.getActiveProducts = function(opt, cb){
		var url = '/getActiveProducts/';
		queryBuilder(opt, function(e, q){
			if(q){
				/* request with */
				url += q;
			}
			sendRequest(url, function(e, r){
				if(r){
					return cb(null, r);
				}else{
					return cb(e, null);
				}
			});
		});
	};



	return prd;
});
